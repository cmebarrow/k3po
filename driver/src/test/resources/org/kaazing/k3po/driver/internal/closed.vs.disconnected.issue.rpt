# ============= request ==================
connect tcp://127.0.0.1:8001
connected

# Connection request
write "Request\r\n"
write "\r\n"

# 101 Response

read "Response\r\n"
read "\r\n"

read notify HANDSHAKE_COMPLETE

write await HANDSHAKE_COMPLETE

close

write notify CLIENT_CLOSE_ISSUED

# If the following line is uncommented the test passes
# read await CLIENT_CLOSE_ISSUED
 
closed

# ============= response ==================
accept tcp://127.0.0.1:8001
accepted
connected

# Connection request
read "Request\r\n"
read "\r\n"

# 101 Response

write "Response\r\n"
write "\r\n"

read await CLIENT_CLOSE_ISSUED

closed
